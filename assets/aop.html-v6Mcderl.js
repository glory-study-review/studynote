import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as s,o as a,d as t}from"./app-BhKC0Yx3.js";const p="/studynote/assets/image-20240807163542516-Bb-Id9vg.png",e="/studynote/assets/image-20240801145438472-Zc8Sv8ga.png",o="/studynote/assets/image-20240801145508873-7DpvreYd.png",c="/studynote/assets/image-20240801152646227-DmAHL9MO.png",i="/studynote/assets/image-20240801152926602-C2aZ_7j5.png",l="/studynote/assets/image-20240801154836736-B4sDvd0c.png",u="/studynote/assets/image-20240801163839669-BDpA47JO.png",r="/studynote/assets/image-20240801145645001-CUvQQ9uV.png",d="/studynote/assets/image-20240806171755555-CoK4l5gd.png",k="/studynote/assets/image-20240807133922084-DYImhA86.png",v="/studynote/assets/image-20240808110524197-BSspxNfv.png",m="/studynote/assets/chain-BRi2D64A.svg",g="/studynote/assets/image-20240808143328748-DM6XnJoq.png",b="/studynote/assets/image-20240808143607474-jzlU2-7Z.png",y="/studynote/assets/image-20240808143905905-ClN2UYgU.png",h="/studynote/assets/image-20240808143852326-IV1Aa2TE.png",A="/studynote/assets/image-20240808150130425-yAJWPsWC.png",f="/studynote/assets/image-20240808150303606-Ckc4H7xG.png",w="/studynote/assets/image-20240808155547343-KbPIiFzj.png",P={},M=t(`<h1 id="spring-aop" tabindex="-1"><a class="header-anchor" href="#spring-aop"><span>Spring AOP</span></a></h1><h2 id="spring-aop中几个主要接口和类" tabindex="-1"><a class="header-anchor" href="#spring-aop中几个主要接口和类"><span>Spring AOP中几个主要接口和类</span></a></h2><h3 id="pointcut" tabindex="-1"><a class="header-anchor" href="#pointcut"><span>PointCut</span></a></h3><p>AOP切点在Spring中的对象</p><p>主要用于 查找匹配 相应的Joinpoint，匹配又分ClassFilter匹配对象和MethodMatcher匹配方法</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Pointcut</span> <span class="token punctuation">{</span>

   <span class="token doc-comment comment">/**
    * Return the ClassFilter for this pointcut.
    * <span class="token keyword">@return</span> the ClassFilter (never <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>)
    */</span>
   <span class="token class-name">ClassFilter</span> <span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

   <span class="token doc-comment comment">/**
    * Return the MethodMatcher for this pointcut.
    * <span class="token keyword">@return</span> the MethodMatcher (never <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token keyword">null</span></span></span><span class="token punctuation">}</span>)
    */</span>
   <span class="token class-name">MethodMatcher</span> <span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


   <span class="token doc-comment comment">/**
    * Canonical Pointcut instance that always matches.
    */</span>
   <span class="token class-name">Pointcut</span> <span class="token constant">TRUE</span> <span class="token operator">=</span> <span class="token class-name">TruePointcut</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>常见的几个实现类<strong>JdkRegexpMethodPointcut</strong>、<strong>NameMatchMethodPointcut</strong>、<strong>AnnotationMatchingPointcut</strong></p><p>JdkRegexpMethodPointcut 通过正则表达式对方法名进行匹配</p><p>NameMatchMethodPointcut 通过匹配方法名进行匹配。</p><p>AnnotationMatchingPointcut 通过匹对是否存在指定类型的注解进行匹配</p><p>MethodMatcher分为静态匹配和动态匹配，以上属于静态匹配，目标方法第一次执行以后都不需要再次做匹配，会有缓存；动态匹配主是参数的匹配，每次执行都需要做匹配操作</p><p><img src="`+p+`" alt="image-20240807163542516" loading="lazy"></p><h3 id="advice" tabindex="-1"><a class="header-anchor" href="#advice"><span>Advice</span></a></h3><p>AOP通知在Spring中的对象</p><p>像MethodBeforeAdvice、AfterReturningAdvice、AspectJAfterAdvice、ThrowsAdvice、AspectJAroundAdvice</p><p>一般的Advice，在Aop代理对象执行方法时，都会通过适配器模式转换为对应的MethodInterceptor类</p><p>而Around的类型直接实现的MethodInterceptor类</p><h3 id="advisor" tabindex="-1"><a class="header-anchor" href="#advisor"><span>Advisor</span></a></h3><p>AOP切面在Spring中的对象</p><p>通知器，定义在哪个Pointcut上执行哪个Advice</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultPointcutAdvisor</span> <span class="token keyword">extends</span> <span class="token class-name">AbstractGenericPointcutAdvisor</span> <span class="token keyword">implements</span> <span class="token class-name">Serializable</span> <span class="token punctuation">{</span>

   <span class="token keyword">private</span> <span class="token class-name">Pointcut</span> pointcut <span class="token operator">=</span> <span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">;</span>


   <span class="token doc-comment comment">/**
    * Create an empty DefaultPointcutAdvisor.
    * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Advice must be set before using setter methods.
    * Pointcut will normally be set also, but defaults to <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span></span></span><span class="token punctuation">}</span>.
    */</span>
   <span class="token keyword">public</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * Create a DefaultPointcutAdvisor that matches all methods.
    * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span></span></span><span class="token punctuation">}</span> will be used as Pointcut.
    * <span class="token keyword">@param</span> <span class="token parameter">advice</span> the Advice to use
    */</span>
   <span class="token keyword">public</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span><span class="token class-name">Advice</span> advice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">(</span><span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">,</span> advice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token doc-comment comment">/**
    * Create a DefaultPointcutAdvisor, specifying Pointcut and Advice.
    * <span class="token keyword">@param</span> <span class="token parameter">pointcut</span> the Pointcut targeting the Advice
    * <span class="token keyword">@param</span> <span class="token parameter">advice</span> the Advice to run when Pointcut matches
    */</span>
   <span class="token keyword">public</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span><span class="token class-name">Pointcut</span> pointcut<span class="token punctuation">,</span> <span class="token class-name">Advice</span> advice<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pointcut <span class="token operator">=</span> pointcut<span class="token punctuation">;</span>
      <span class="token function">setAdvice</span><span class="token punctuation">(</span>advice<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>


   <span class="token doc-comment comment">/**
    * Specify the pointcut targeting the advice.
    * <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span>Default is <span class="token punctuation">{</span><span class="token keyword">@code</span> <span class="token code-section"><span class="token code language-java"><span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span></span></span><span class="token punctuation">}</span>.
    * <span class="token keyword">@see</span> <span class="token reference"><span class="token punctuation">#</span><span class="token field">setAdvice</span></span>
    */</span>
   <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setPointcut</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Pointcut</span> pointcut<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>pointcut <span class="token operator">=</span> <span class="token punctuation">(</span>pointcut <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> pointcut <span class="token operator">:</span> <span class="token class-name">Pointcut</span><span class="token punctuation">.</span><span class="token constant">TRUE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">Pointcut</span> <span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>pointcut<span class="token punctuation">;</span>
   <span class="token punctuation">}</span>


   <span class="token annotation punctuation">@Override</span>
   <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;: pointcut [&quot;</span> <span class="token operator">+</span> <span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]; advice [&quot;</span> <span class="token operator">+</span> <span class="token function">getAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot;]&quot;</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="织入器" tabindex="-1"><a class="header-anchor" href="#织入器"><span>织入器</span></a></h3><p>Advisor类有了，那如何将切面织入目标对象生成对应的代理对象呢</p><p>Spring提供了org.springframework.aop.framework.ProxyFactory类</p><p><img src="`+e+'" alt="image-20240801145438472" loading="lazy"></p><p>该类的主要方法</p><p>通过构造器可以传入目标对象</p><p>getProxy()获取最终的AOP代理对象</p><p><img src="'+o+'" alt="image-20240801145508873" loading="lazy"></p><p>看看getProxy()做了什么：</p><p><img src="'+c+'" alt="image-20240801152646227" loading="lazy"></p><p>通过其父类org.springframework.aop.framework.ProxyCreatorSupport的createAopProxy()方法获取<strong>AopProxy</strong>接口类的实现类，再通过AopProxy的getProxy()方法获取目标的Aop代理类。</p><p>AopProxy的实现类有<img src="'+i+'" alt="image-20240801152926602" loading="lazy"></p><p>所以说SpringAOP通过Cglib和Jdk两种动态代理方式实现</p><p>通过探寻createAopProxy()方法可以发现最终调用org.springframework.aop.framework.DefaultAopProxyFactory的createAopProxy()方法</p><p>可以看到不同情况会使用不同的动态代理方法</p><p><img src="'+l+'" alt="image-20240801154836736" loading="lazy"></p><p>获取到对应的AopProxy后，调用getProxy()方法获取代理对象，这里拿<strong>JdkDynamicAopProxy</strong>类的展示</p><p>Proxy.newProxyInstance(),JDK动态代理创建</p><p><img src="'+u+'" alt="image-20240801163839669" loading="lazy"></p><p>从ProxyFactory的方法中似乎没有将Advisor织入的方法，其实是其父类的父类org.springframework.aop.framework.AdvisedSupport提供的</p><p>并且JdkDynamicAopProxy和CglibAopProxy也会持有AdvisedSupport类属性，用于获取Advisor、Advice等内容</p><p><img src="'+r+'" alt="image-20240801145645001" loading="lazy"></p><h2 id="aop代理执行过程" tabindex="-1"><a class="header-anchor" href="#aop代理执行过程"><span>AOP代理执行过程</span></a></h2><p>通过上述内容，明白AOP的代理生成是由Jdk或Cglib代理实现，那AOP代理对象执行方法时，又是如何根据切面来增强原方法的呢？</p><h3 id="jdkdynamicaopproxy的invoke" tabindex="-1"><a class="header-anchor" href="#jdkdynamicaopproxy的invoke"><span>JdkDynamicAopProxy的invoke()</span></a></h3><p>大家都知道，Jdk动态代理中，代理增强的方法是由</p><p><code>Proxy.newProxyInstance(ClassLoader loader,Class&lt;?&gt;[] interfaces,InvocationHandler h)</code>方法中的第三个参数InvocationHandler的invoke方法实现的</p><p>上一节中，<strong>JdkDynamicAopProxy</strong>使用Jdk动态代理实现Aop代理时，将<strong>this</strong>作为第三个参数传入，JdkDynamicAopProxy也确实实现了InvocationHandler接口</p><p><img src="'+d+'" alt="image-20240806171755555" loading="lazy"></p><p>因此AOP代理对各通知的调用在<strong>JdkDynamicAopProxy</strong>的<code>invoke()</code>方法中实现，方法中的关键部分</p><p><img src="'+k+`" alt="image-20240807133922084" loading="lazy"></p><h3 id="获取拦截器链" tabindex="-1"><a class="header-anchor" href="#获取拦截器链"><span>获取拦截器链</span></a></h3><p>使用持有的AdvisedSupport，获取目标方法的拦截器链</p><p>拦截器链是通过AdvisedSupport中持有的Advisors，获取Pointcut进行方法的匹配，使用<strong>适配器模式</strong>生成MethodInterceptor(如果是动态匹配，会将MethodInterceptor和MethodMatcher封装为<strong>InterceptorAndDynamicMethodMatcher</strong>对象)，最后组成的集合</p><p>由AdvisedSupport持有的advisorChainFactory属性(org.springframework.aop.framework.DefaultAdvisorChainFactory)调用getInterceptorsAndDynamicInterceptionAdvice()方法完成：</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> <span class="token function">getInterceptorsAndDynamicInterceptionAdvice</span><span class="token punctuation">(</span>
    <span class="token class-name">Advised</span> config<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// This is somewhat tricky... We have to process introductions first,</span>
    <span class="token comment">// but we need to preserve order in the ultimate list.</span>
    <span class="token class-name">AdvisorAdapterRegistry</span> registry <span class="token operator">=</span> <span class="token class-name">GlobalAdvisorAdapterRegistry</span><span class="token punctuation">.</span><span class="token function">getInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 从AdvisedSupport中获取所有Advisor通知器</span>
    <span class="token class-name">Advisor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> advisors <span class="token operator">=</span> config<span class="token punctuation">.</span><span class="token function">getAdvisors</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> interceptorList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>advisors<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> actualClass <span class="token operator">=</span> <span class="token punctuation">(</span>targetClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> targetClass <span class="token operator">:</span> method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">Boolean</span> hasIntroductions <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

    <span class="token comment">//遍历通知器，根据Advisor持有的Pointcut 进行方法匹配</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Advisor</span> advisor <span class="token operator">:</span> advisors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>advisor <span class="token keyword">instanceof</span> <span class="token class-name">PointcutAdvisor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Add it conditionally.</span>
            <span class="token class-name">PointcutAdvisor</span> pointcutAdvisor <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">PointcutAdvisor</span><span class="token punctuation">)</span> advisor<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isPreFiltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> pointcutAdvisor<span class="token punctuation">.</span><span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>actualClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">MethodMatcher</span> mm <span class="token operator">=</span> pointcutAdvisor<span class="token punctuation">.</span><span class="token function">getPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">boolean</span> match<span class="token punctuation">;</span>
                <span class="token comment">//方法匹配</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>mm <span class="token keyword">instanceof</span> <span class="token class-name">IntroductionAwareMethodMatcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>hasIntroductions <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        hasIntroductions <span class="token operator">=</span> <span class="token function">hasMatchingIntroductions</span><span class="token punctuation">(</span>advisors<span class="token punctuation">,</span> actualClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                    match <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">IntroductionAwareMethodMatcher</span><span class="token punctuation">)</span> mm<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> actualClass<span class="token punctuation">,</span> hasIntroductions<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">else</span> <span class="token punctuation">{</span>
                    match <span class="token operator">=</span> mm<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> actualClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>match<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">//匹配成功，通过适配器将advisor中的Advice转换为MethodInterceptor</span>
                    <span class="token class-name">MethodInterceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">//根据是否是运行时匹配，如果是，则创建一个InterceptorAndDynamicMethodMatcher对象</span>
					<span class="token comment">//运行时匹配主要指，需要通过参数匹配的情况</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span>mm<span class="token punctuation">.</span><span class="token function">isRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token comment">// Creating a new object instance in the getInterceptors() method</span>
                        <span class="token comment">// isn&#39;t a problem as we normally cache created chains.</span>
                        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span> interceptor <span class="token operator">:</span> interceptors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            interceptorList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">InterceptorAndDynamicMethodMatcher</span><span class="token punctuation">(</span>interceptor<span class="token punctuation">,</span> mm<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span>
                    <span class="token keyword">else</span> <span class="token punctuation">{</span>
                        interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>advisor <span class="token keyword">instanceof</span> <span class="token class-name">IntroductionAdvisor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">IntroductionAdvisor</span> ia <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">IntroductionAdvisor</span><span class="token punctuation">)</span> advisor<span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>config<span class="token punctuation">.</span><span class="token function">isPreFiltered</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> ia<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span>actualClass<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">Interceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
                interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Interceptor</span><span class="token punctuation">[</span><span class="token punctuation">]</span> interceptors <span class="token operator">=</span> registry<span class="token punctuation">.</span><span class="token function">getInterceptors</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
            interceptorList<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span><span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>interceptors<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> interceptorList<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拦截器链调用" tabindex="-1"><a class="header-anchor" href="#拦截器链调用"><span>拦截器链调用</span></a></h3><p>如果目标方法存在通知，就能获取相应的拦截器链，拦截器链的调用由<strong>ReflectiveMethodInvocation</strong>的proceed()执行</p><p>ReflectiveMethodInvocation 通过构造器持有代理对象，目标对象，方法对象，方法参数，和拦截器集合</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">ReflectiveMethodInvocation</span><span class="token punctuation">(</span>
      <span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> arguments<span class="token punctuation">,</span>
      <span class="token annotation punctuation">@Nullable</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">,</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> interceptorsAndDynamicMethodMatchers<span class="token punctuation">)</span> <span class="token punctuation">{</span>

   <span class="token keyword">this</span><span class="token punctuation">.</span>proxy <span class="token operator">=</span> proxy<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>target <span class="token operator">=</span> target<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>targetClass <span class="token operator">=</span> targetClass<span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>method <span class="token operator">=</span> <span class="token class-name">BridgeMethodResolver</span><span class="token punctuation">.</span><span class="token function">findBridgedMethod</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>arguments <span class="token operator">=</span> <span class="token class-name">AopProxyUtils</span><span class="token punctuation">.</span><span class="token function">adaptArgumentsIfNecessary</span><span class="token punctuation">(</span>method<span class="token punctuation">,</span> arguments<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorsAndDynamicMethodMatchers <span class="token operator">=</span> interceptorsAndDynamicMethodMatchers<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过递归调用proceed()，遍历调用拦截器链，看一下proceed()方法</p><p>最后都是调用拦截器的invoke方法，参数传入ReflectiveMethodInvocation对象自身，在拦截器中再调用proceed()来进行拦截器链的遍历调用</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
	<span class="token comment">// We start with an index of -1 and increment early.</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentInterceptorIndex <span class="token operator">==</span> <span class="token keyword">this</span><span class="token punctuation">.</span>interceptorsAndDynamicMethodMatchers<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">//当拦截器链全部调用完毕，调用目标方法，内部也是使用 AopUtils.invokeJoinpointUsingReflection()完成</span>
		<span class="token keyword">return</span> <span class="token function">invokeJoinpoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token comment">//获取下一个拦截器</span>
	<span class="token class-name">Object</span> interceptorOrInterceptionAdvice <span class="token operator">=</span>
			<span class="token keyword">this</span><span class="token punctuation">.</span>interceptorsAndDynamicMethodMatchers<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">++</span><span class="token keyword">this</span><span class="token punctuation">.</span>currentInterceptorIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token comment">//判断是否为动态匹配</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span>interceptorOrInterceptionAdvice <span class="token keyword">instanceof</span> <span class="token class-name">InterceptorAndDynamicMethodMatcher</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token comment">// 是动态匹配</span>
		<span class="token comment">// Evaluate dynamic method matcher here: static part will already have</span>
		<span class="token comment">// been evaluated and found to match.</span>
		<span class="token class-name">InterceptorAndDynamicMethodMatcher</span> dm <span class="token operator">=</span>
				<span class="token punctuation">(</span><span class="token class-name">InterceptorAndDynamicMethodMatcher</span><span class="token punctuation">)</span> interceptorOrInterceptionAdvice<span class="token punctuation">;</span>
		<span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>targetClass <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> <span class="token keyword">this</span><span class="token punctuation">.</span>targetClass <span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">.</span>getDeclaringClass
		<span class="token keyword">if</span> <span class="token punctuation">(</span>dm<span class="token punctuation">.</span>methodMatcher<span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>method<span class="token punctuation">,</span> targetClass<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>arguments<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token keyword">return</span> dm<span class="token punctuation">.</span>interceptor<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
		<span class="token keyword">else</span> <span class="token punctuation">{</span>
			<span class="token comment">// Dynamic matching failed.</span>
			<span class="token comment">// Skip this interceptor and invoke the next in the chain.</span>
			<span class="token keyword">return</span> <span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">else</span> <span class="token punctuation">{</span>
		<span class="token comment">// 不是动态匹配，直接调用各拦截器的invoke方法</span>
		<span class="token comment">// It&#39;s an interceptor, so we just invoke it: The pointcut will have</span>
		<span class="token comment">// been evaluated statically before this object was constructed.</span>
		<span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">MethodInterceptor</span><span class="token punctuation">)</span> interceptorOrInterceptionAdvice<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以下AOP切面示例</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">A</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public void com.example.springbootaopdemo.demo.Cat.eat())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public void com.example.springbootaopdemo.demo.Cat.eat())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around-before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around-after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public void com.example.springbootaopdemo.demo.Cat.eat())&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
    <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token annotation punctuation">@Component</span><span class="token punctuation">(</span><span class="token string">&quot;cat&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">implements</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">eat</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;猫吃鱼&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在ReflectiveMethodInvocation的proceed()执行时，拦截链中的各拦截器</p><p><img src="`+v+`" alt="image-20240808110524197" loading="lazy"></p><p>MethodBeforeAdviceInterceptor的invoke()</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
   <span class="token comment">//先调用before类型的advice，再调用mi.proceed()继续调用后续拦截器</span>
   <span class="token comment">//before 内部使用AbstractAspectJAdvice的模板方法invokeAdviceMethod</span>
   <span class="token keyword">this</span><span class="token punctuation">.</span>advice<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>mi<span class="token punctuation">.</span><span class="token function">getMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getArguments</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> mi<span class="token punctuation">.</span><span class="token function">getThis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AspectJAfterAdvice的inovke()</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token comment">//先继续调用后续拦截器为了最后执行原方法，再执行after方法</span>
    <span class="token comment">//因为After是无论原方法执行成功与否都需要执行的逻辑，所以使用finally</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> mi<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">finally</span> <span class="token punctuation">{</span>
        <span class="token comment">//执行父类AbstractAspectJAdvice的模板方法，来执行after方法</span>
        <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span><span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>AspectJAroundAdvice的invoke()方法</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">MethodInvocation</span> mi<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span>mi <span class="token keyword">instanceof</span> <span class="token class-name">ProxyMethodInvocation</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">IllegalStateException</span><span class="token punctuation">(</span><span class="token string">&quot;MethodInvocation is not a Spring ProxyMethodInvocation: &quot;</span> <span class="token operator">+</span> mi<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token class-name">ProxyMethodInvocation</span> pmi <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ProxyMethodInvocation</span><span class="token punctuation">)</span> mi<span class="token punctuation">;</span>
   <span class="token class-name">ProceedingJoinPoint</span> pjp <span class="token operator">=</span> <span class="token function">lazyGetProceedingJoinPoint</span><span class="token punctuation">(</span>pmi<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token class-name">JoinPointMatch</span> jpm <span class="token operator">=</span> <span class="token function">getJoinPointMatch</span><span class="token punctuation">(</span>pmi<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token comment">//调用AbstractAspectJAdvice的invokeAdviceMethod方法</span>
   <span class="token keyword">return</span> <span class="token function">invokeAdviceMethod</span><span class="token punctuation">(</span>pjp<span class="token punctuation">,</span> jpm<span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">,</span> <span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>没有显示的调用proceed()，因为对于Around类似的通知，proceed()由ProceedingJoinPoint调用，调用时机交给用户控制</p><p>对于用户来说调用proceed()是调用目标原方法，内部其实先去调用剩余的拦截器链才最后调用的目标原方法。</p><p>如上述A切面的Around方法</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public void com.example.springbootaopdemo.demo.Cat.eat())&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">around</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> joinPoint<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around-before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    joinPoint<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;around-after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>根据上述例子拦截器链的顺序，执行过程顺序为</p><p><img src="`+m+'" alt="chain" loading="lazy"></p><h2 id="通知类的排序" tabindex="-1"><a class="header-anchor" href="#通知类的排序"><span>通知类的排序</span></a></h2><h3 id="第一次排序" tabindex="-1"><a class="header-anchor" href="#第一次排序"><span>第一次排序</span></a></h3><p>上一章节看到，Cat类的AOP代理对象在执行相关方法时，通知类构造的拦截器顺序是Around-&gt;Before-&gt;After，而我们在切面中定义Advice时先按顺序是Before-&gt;Around-&gt;After，所以Aspect切面中的Advice类生成后，肯定进行了排序。</p><p>首先得弄清楚Advice类在何时创建</p><p>经过调用栈发现在切面类Bean的AnnotationAwareAspectJAutoProxyCreator后置处理器的postProcessBeforeInstantiation()方法中(实质调用的是AbstractAutoProxyCreator的方法)，最终会调用<strong>BeanFactoryAspectJAdvisorsBuilder</strong>的<code>buildAspectJAdvisors()</code>来生成和缓存当前Aspect中的Advisor</p><blockquote><p>这里生成的Advisor是InstantiationModelAwarePointcutAdvisorImpl类，创建InstantiationModelAwarePointcutAdvisorImpl对象时，在构造器中也创建了Advice</p><p>InstantiationModelAwarePointcutAdvisorImpl类在为目标对象创建代理对象时，会转换为Advisor类型</p></blockquote><p><img src="'+g+'" alt="image-20240808143328748" loading="lazy"></p><p>getAdvisors()方法调用的是<strong>ReflectiveAspectJAdvisorFactory</strong>类实现的方法</p><p>debug会发现其中的getAdvisorMethods(aspectClass)语句给出的Method集合就是按照Around-&gt;Before-&gt;After顺序给出的</p><p><img src="'+b+'" alt="image-20240808143607474" loading="lazy"></p><p>看一下getAdvisorMethods()方法，主要到执行了<code>methods.sort(adviceMethodComparator)</code></p><p><img src="'+y+'" alt="image-20240808143905905" loading="lazy"></p><p>adviceMethodComparator是一个Comparator，内容在该类静态代码块中复制</p><p><img src="'+h+'" alt="image-20240808143852326" loading="lazy"></p><p>所以一个切面内的Advice顺序按照<strong>Around, Before, After, AfterReturning, AfterThrowing</strong></p><h3 id="第二次排序" tabindex="-1"><a class="header-anchor" href="#第二次排序"><span>第二次排序</span></a></h3><p>当目标对象在后置处理器中进行AOP代理创建时，会查询所有属于目标对象的通知器类，那不同切面的Advisor如何排序</p><p>找到目标对象的AOP代理对象生成的后置处理方法AbstractAutoProxyCreator的postProcessAfterInitialization()其中的wrapIfNecessary()</p><p>其中的getAdvicesAndAdvisorsForBean()就是查找目标对象是否有Advisor</p><p><img src="'+A+'" alt="image-20240808150130425" loading="lazy"></p><p>进入方法，在其子类<strong>AbstractAdvisorAutoProxyCreator</strong>的findEligibleAdvisors()方法中可以看到<code>eligibleAdvisors = sortAdvisors(eligibleAdvisors);</code></p><p><img src="'+f+`" alt="image-20240808150303606" loading="lazy"></p><p>使用的是子类<strong>AspectJAwareAdvisorAutoProxyCreator</strong>的sortAdvisors()</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token keyword">protected</span> <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> <span class="token function">sortAdvisors</span><span class="token punctuation">(</span><span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> advisors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartiallyComparableAdvisorHolder</span><span class="token punctuation">&gt;</span></span> partiallyComparableAdvisors <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>advisors<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">Advisor</span> advisor <span class="token operator">:</span> advisors<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">//构造PartiallyComparableAdvisorHolder 实现了PartialComparable</span>
        <span class="token comment">// DEFAULT_PRECEDENCE_COMPARATOR 赋值为 AspectJPrecedenceComparator类对象，该对象拥有一个AnnotationAwareOrderComparator(OrderComparator的子类)</span>
        partiallyComparableAdvisors<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>
            <span class="token keyword">new</span> <span class="token class-name">PartiallyComparableAdvisorHolder</span><span class="token punctuation">(</span>advisor<span class="token punctuation">,</span> <span class="token constant">DEFAULT_PRECEDENCE_COMPARATOR</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//进行偏序排序</span>
    <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">PartiallyComparableAdvisorHolder</span><span class="token punctuation">&gt;</span></span> sorted <span class="token operator">=</span> <span class="token class-name">PartialOrder</span><span class="token punctuation">.</span><span class="token function">sort</span><span class="token punctuation">(</span>partiallyComparableAdvisors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>sorted <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">List</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Advisor</span><span class="token punctuation">&gt;</span></span> result <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span>advisors<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token class-name">PartiallyComparableAdvisorHolder</span> pcAdvisor <span class="token operator">:</span> sorted<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            result<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>pcAdvisor<span class="token punctuation">.</span><span class="token function">getAdvisor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">//偏序排序的结构为空时，使用父类的sortAdvisors，内部就是AnnotationAwareOrderComparator.sort(advisors)</span>
        <span class="token keyword">return</span> <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">sortAdvisors</span><span class="token punctuation">(</span>advisors<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>偏序排序没有深入研究，但是在PartialOrder.sort()方中还是调用了<strong>DEFAULT_PRECEDENCE_COMPARATOR</strong>(AspectJPrecedenceComparator)的compareTo方法，<strong>AspectJPrecedenceComparator</strong>类的compareTo实际使用的<strong>AnnotationAwareOrderComparator</strong>的compareTo，AnnotationAwareOrderComparator并没重写compareTo，使用的OrderComparator的方法，也就是按照Advisor的Order进行排序的</p><p>那Advisor的Order哪来的。</p><p>在第一次排序中我们说到Advisor在切面Bean初始化时创建，并且创建的实际上是InstantiationModelAwarePointcutAdvisorImpl类，其是间接实现了Ordered接口的</p><p><img src="`+w+`" alt="image-20240808155547343" loading="lazy"></p><p>InstantiationModelAwarePointcutAdvisorImpl的getOrder()方法最终是调用BeanFactoryAspectInstanceFactory的getOrder()</p><p>其中的name就是切面类bean的name</p><div class="language-java line-numbers-mode" data-ext="java" data-title="java"><pre class="language-java"><code><span class="token annotation punctuation">@Override</span>
<span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
   <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> type <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">getType</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token keyword">if</span> <span class="token punctuation">(</span>type <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>type<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">isSingleton</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
         <span class="token keyword">return</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">Ordered</span><span class="token punctuation">)</span> <span class="token keyword">this</span><span class="token punctuation">.</span>beanFactory<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">return</span> <span class="token class-name">OrderUtils</span><span class="token punctuation">.</span><span class="token function">getOrder</span><span class="token punctuation">(</span>type<span class="token punctuation">,</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">LOWEST_PRECEDENCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
   <span class="token punctuation">}</span>
   <span class="token keyword">return</span> <span class="token class-name">Ordered</span><span class="token punctuation">.</span><span class="token constant">LOWEST_PRECEDENCE</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>也就是最终一个AOP代理对象中的拦截器或者说通知器的顺序，是按照切面类的Order来的，如果是同一个切面类中的是按照既定的<strong>Around, Before, After, AfterReturning, AfterThrowing</strong>顺序</p>`,112),C=[M];function x(j,I){return a(),s("div",null,C)}const D=n(P,[["render",x],["__file","aop.html.vue"]]),J=JSON.parse('{"path":"/spring/spring-framework/aop.html","title":"Spring AOP","lang":"zh-CN","frontmatter":{"description":"Spring AOP Spring AOP中几个主要接口和类 PointCut AOP切点在Spring中的对象 主要用于 查找匹配 相应的Joinpoint，匹配又分ClassFilter匹配对象和MethodMatcher匹配方法 常见的几个实现类JdkRegexpMethodPointcut、NameMatchMethodPointcut、Ann...","head":[["meta",{"property":"og:url","content":"https://glory-study-review.github.io/studynote/studynote/spring/spring-framework/aop.html"}],["meta",{"property":"og:site_name","content":"Glory学习笔记"}],["meta",{"property":"og:title","content":"Spring AOP"}],["meta",{"property":"og:description","content":"Spring AOP Spring AOP中几个主要接口和类 PointCut AOP切点在Spring中的对象 主要用于 查找匹配 相应的Joinpoint，匹配又分ClassFilter匹配对象和MethodMatcher匹配方法 常见的几个实现类JdkRegexpMethodPointcut、NameMatchMethodPointcut、Ann..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-08-08T08:24:03.000Z"}],["meta",{"property":"article:author","content":"Glory"}],["meta",{"property":"article:modified_time","content":"2024-08-08T08:24:03.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Spring AOP\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2024-08-08T08:24:03.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Glory\\"}]}"]]},"headers":[{"level":2,"title":"Spring AOP中几个主要接口和类","slug":"spring-aop中几个主要接口和类","link":"#spring-aop中几个主要接口和类","children":[{"level":3,"title":"PointCut","slug":"pointcut","link":"#pointcut","children":[]},{"level":3,"title":"Advice","slug":"advice","link":"#advice","children":[]},{"level":3,"title":"Advisor","slug":"advisor","link":"#advisor","children":[]},{"level":3,"title":"织入器","slug":"织入器","link":"#织入器","children":[]}]},{"level":2,"title":"AOP代理执行过程","slug":"aop代理执行过程","link":"#aop代理执行过程","children":[{"level":3,"title":"JdkDynamicAopProxy的invoke()","slug":"jdkdynamicaopproxy的invoke","link":"#jdkdynamicaopproxy的invoke","children":[]},{"level":3,"title":"获取拦截器链","slug":"获取拦截器链","link":"#获取拦截器链","children":[]},{"level":3,"title":"拦截器链调用","slug":"拦截器链调用","link":"#拦截器链调用","children":[]}]},{"level":2,"title":"通知类的排序","slug":"通知类的排序","link":"#通知类的排序","children":[{"level":3,"title":"第一次排序","slug":"第一次排序","link":"#第一次排序","children":[]},{"level":3,"title":"第二次排序","slug":"第二次排序","link":"#第二次排序","children":[]}]}],"git":{"createdTime":1722925364000,"updatedTime":1723105443000,"contributors":[{"name":"Glory","email":"214521739@qq.com","commits":2}]},"readingTime":{"minutes":9.53,"words":2858},"filePathRelative":"spring/spring-framework/aop.md","localizedDate":"2024年8月6日","autoDesc":true,"excerpt":"\\n<h2>Spring AOP中几个主要接口和类</h2>\\n<h3>PointCut</h3>\\n<p>AOP切点在Spring中的对象</p>\\n<p>主要用于 查找匹配 相应的Joinpoint，匹配又分ClassFilter匹配对象和MethodMatcher匹配方法</p>\\n<div class=\\"language-java\\" data-ext=\\"java\\" data-title=\\"java\\"><pre class=\\"language-java\\"><code><span class=\\"token keyword\\">public</span> <span class=\\"token keyword\\">interface</span> <span class=\\"token class-name\\">Pointcut</span> <span class=\\"token punctuation\\">{</span>\\n\\n   <span class=\\"token doc-comment comment\\">/**\\n    * Return the ClassFilter for this pointcut.\\n    * <span class=\\"token keyword\\">@return</span> the ClassFilter (never <span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">@code</span> <span class=\\"token code-section\\"><span class=\\"token code language-java\\"><span class=\\"token keyword\\">null</span></span></span><span class=\\"token punctuation\\">}</span>)\\n    */</span>\\n   <span class=\\"token class-name\\">ClassFilter</span> <span class=\\"token function\\">getClassFilter</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n   <span class=\\"token doc-comment comment\\">/**\\n    * Return the MethodMatcher for this pointcut.\\n    * <span class=\\"token keyword\\">@return</span> the MethodMatcher (never <span class=\\"token punctuation\\">{</span><span class=\\"token keyword\\">@code</span> <span class=\\"token code-section\\"><span class=\\"token code language-java\\"><span class=\\"token keyword\\">null</span></span></span><span class=\\"token punctuation\\">}</span>)\\n    */</span>\\n   <span class=\\"token class-name\\">MethodMatcher</span> <span class=\\"token function\\">getMethodMatcher</span><span class=\\"token punctuation\\">(</span><span class=\\"token punctuation\\">)</span><span class=\\"token punctuation\\">;</span>\\n\\n\\n   <span class=\\"token doc-comment comment\\">/**\\n    * Canonical Pointcut instance that always matches.\\n    */</span>\\n   <span class=\\"token class-name\\">Pointcut</span> <span class=\\"token constant\\">TRUE</span> <span class=\\"token operator\\">=</span> <span class=\\"token class-name\\">TruePointcut</span><span class=\\"token punctuation\\">.</span><span class=\\"token constant\\">INSTANCE</span><span class=\\"token punctuation\\">;</span>\\n\\n<span class=\\"token punctuation\\">}</span>\\n</code></pre></div>"}');export{D as comp,J as data};
